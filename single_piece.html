<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Один кусочек паззла (4 шипа)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f0f0f0;
    }
    #puzzlecontainer {
      border: 1px solid #ccc;
      margin: 20px auto;
      width: 200px;
      height: 200px;
    }
    button {
      margin: 5px;
      padding: 8px 12px;
    }
    input {
      margin: 3px 5px;
    }
  </style>
</head>
<body>

<svg id="puzzlecontainer" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
  <!-- Кусочки будут добавляться сюда -->
</svg>

<script>
  // --- Вспомогательные функции ---
  let seed = 1;
  function random() {
    const x = Math.sin(seed++) * 10000;
    return x - Math.floor(x);
  }

  function uniform(min, max) {
    return min + random() * (max - min);
  }

  function rbool() { return random() > 0.5; }

  // --- Отрисовка одного кусочка ---
  function drawPiece(x = 0, y = 0) {
    const svg = document.getElementById("puzzlecontainer");

    // Определяем уникальный ID
    const existingPaths = svg.querySelectorAll("path");
    const newId = `piece-${existingPaths.length + 1}`;

    const w = 120; // ширина
    const h = 120; // высота

    const t = 0.1; // размер шипа 10%
    const j = 0;   // jitter 0

    const isTopOut = true

    let str = "";

    // --- Верхняя грань ---
    let flip = false;
    let a, b, c, d, e;

    function first() { e = uniform(-j, j); next(); }
    function next() { const flipold = flip; flip = rbool(); a = (flip === flipold ? -e : e); b = uniform(-j, j); c = uniform(-j, j); d = uniform(-j, j); e = uniform(-j, j); }

    first();

    str += `M ${x} ${y} `;
    for (let i = 0; i < 1; i++) {
      // Инвертируем y-сдвиги, чтобы шип был вверх
      str += `C ${x + w * 0.2}
                ${isTopOut ? y - a * h * t : y + a * h * t},
                
                ${x + w * 0.5 + b * w * t}
                ${isTopOut ? y + t * h + c * h * t : y - t * h + c * h * t},

                ${x + w * 0.5 - t * w + b * w * t}
                ${isTopOut ? y - t * h + c * h * t : y + t * h + c * h * t} `;

      str += `C ${x + w * 0.5 - 2.0 * t * w + b * w * t - d * w * t}
                ${isTopOut ? y - 3.0 * t * h + c * h * t : y + 3.0 * t * h + c * h * t},
                
                ${x + w * 0.5 + 2.0 * t * w + b * w * t - d * w * t}
                ${isTopOut ? y - 3.0 * t * h + c * h * t : y + 3.0 * t * h + c * h * t },
                
                ${x + w * 0.5 + t * w + b * w * t}
                ${isTopOut ? y - t * h + c * h * t : y + t * h + c * h * t} `;

      str += `C 
              ${x + w * 0.5 + b * w * t + d * w * t}
              ${isTopOut ? y + t * h + c * h * t : y - t * h + c * h * t},
              
              ${x + w * 0.8}
              ${isTopOut ? y - e * h * t : y + e * h * t},
              
              ${x + w}
              ${y} `;
              next();
    }

    // --- Правая грань ---
    flip = false; // шип "влево"
    first();

    for (let i = 0; i < 1; i++) {
      str += `C ${x + w + a * w * t} ${y + h * 0.2}, ${x + w - t * w + b * w * t} ${y + h * 0.5 + c * h * t}, ${x + w + t * w + b * w * t} ${y + h * 0.5 - t * h + c * h * t} `;
      str += `C ${x + w + 3.0 * t * w + b * w * t} ${y + h * 0.5 - 2.0 * t * h + c * h * t}, ${x + w + 3.0 * t * w + b * w * t} ${y + h * 0.5 + 2.0 * t * h + c * h * t}, ${x + w + t * w + b * w * t} ${y + h * 0.5 + t * h + c * h * t} `;
      str += `C ${x + w - t * w + b * w * t} ${y + h * 0.5 + c * h * t}, ${x + w + e * w * t} ${y + h * 0.8}, ${x + w} ${y + h} `;
      next();
    }

    // --- Нижняя грань ---
    flip = false; // шип "вверх"
    first();

    for (let i = 0; i < 1; i++) {
      str += `C ${x + w * 0.8} ${y + h + e * h * t}, ${x + w * 0.5 + b * w * t + d * w * t} ${y + h - t * h + c * h * t}, ${x + w * 0.5 + t * w + b * w * t} ${y + h + t * h + c * h * t} `;
      str += `C ${x + w * 0.5 + 2.0 * t * w + b * w * t - d * w * t} ${y + h + 3.0 * t * h + c * h * t}, ${x + w * 0.5 - 2.0 * t * w + b * w * t - d * w * t} ${y + h + 3.0 * t * h + c * h * t}, ${x + w * 0.5 - t * w + b * w * t} ${y + h + t * h + c * h * t} `;
      str += `C ${x + w * 0.5 - t * w + b * w * t} ${y + h - t * h + c * h * t}, ${x + w * 0.2} ${y + h + a * h * t}, ${x} ${y + h} `;
      next();
    }

    // --- Левая грань ---
    flip = true; // шип "вправо"
    first();

    for (let i = 0; i < 1; i++) {
      // Отражаем правую грань: x → x, y → y, но шипы идут снизу вверх
      str += `C ${x - a * w * t} ${y + h * 0.8}, ${x + t * w - b * w * t} ${y + h * 0.5 + c * h * t}, ${x - t * w - b * w * t} ${y + h * 0.5 + t * h + c * h * t} `;
      str += `C ${x - 3.0 * t * w - b * w * t} ${y + h * 0.5 + 2.0 * t * h + c * h * t}, ${x - 3.0 * t * w - b * w * t} ${y + h * 0.5 - 2.0 * t * h + c * h * t}, ${x - t * w - b * w * t} ${y + h * 0.5 - t * h + c * h * t} `;
      str += `C ${x + t * w - b * w * t} ${y + h * 0.5 + c * h * t}, ${x - e * w * t} ${y + h * 0.2}, ${x} ${y} `;
      next();
    }

    str += " Z";

    // Создаём новый path с уникальным ID
    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("id", newId);
    path.setAttribute("d", str);
    path.setAttribute("fill", "lightblue");
    path.setAttribute("stroke", "#000");
    path.setAttribute("stroke-width", "2");

    svg.appendChild(path);
  }


  // --- Инициализация ---
  drawPiece(0, 0);
  // drawPiece(120, 0);
</script>

</body>
</html>