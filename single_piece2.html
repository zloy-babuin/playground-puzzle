<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Один кусочек паззла (4 шипа)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f0f0f0;
    }
    #puzzlecontainer {
      border: 1px solid #ccc;
      margin: 20px auto;
      width: 600px;
      height: 600px;
    }
    button {
      margin: 5px;
      padding: 8px 12px;
    }
    input {
      margin: 3px 5px;
    }
  </style>
</head>
<body>

<svg id="puzzlecontainer" width="600" height="600" xmlns="http://www.w3.org/2000/svg">
  <!-- Кусочки будут добавляться сюда -->
</svg>

<script>
  // --- Вспомогательные функции ---
  let seed = 1;
  function random() {
    const x = Math.sin(seed++) * 10000;
    return x - Math.floor(x);
  }

  function uniform(min, max) {
    return min + random() * (max - min);
  }

  function rbool() { return random() > 0.5; }

  // --- Отрисовка одного кусочка ---
// --- Отрисовка одного кусочка ---
function drawPiece(x = 0, y = 0, isTopOut, isRightOut, isBottomOut, isLeftOut, curves) {
  const svg = document.getElementById("puzzlecontainer");

  // Определяем уникальный ID
  const existingPaths = svg.querySelectorAll("path");
  const newId = `piece-${existingPaths.length + 1}`;

  const w = 120; // ширина
  const h = 120; // высота

  const t = 0.12; // размер шипа 10%
  const j = 0;   // jitter 0

  // Направления шипов (можно позже сделать случайными)
  // const isTopOut = true;
  // const isRightOut = false; // шип "влево" → внутрь, значит не наружу
  // const isBottomOut = true; // шип "вверх" → внутрь → не наружу
  // const isLeftOut = false;   // шип "вправо" → наружу

  let str = "";

  // --- Верхняя грань ---
  let flip = false;
  let a, b, c, d, e;

  function first() { e = uniform(-j, j); next(); }
  function next() { 
    const flipold = flip; 
    flip = rbool(); 
    a = (flip === flipold ? -e : e); 
    b = uniform(-j, j); 
    c = uniform(-j, j); 
    d = uniform(-j, j); 
    e = uniform(-j, j); 
  }

  first();

  str += `M ${x} ${y} `;
  if (curves & 1) {
    for (let i = 0; i < 1; i++) {
      str += `C 
        ${x + w * 0.2}
        ${isTopOut ? y - a * h * t : y + a * h * t},
        
        ${x + w * 0.5 + b * w * t}
        ${isTopOut ? y + t * h + c * h * t : y - t * h + c * h * t},
        
        ${x + w * 0.5 - t * w + b * w * t}
        ${isTopOut ? y - t * h + c * h * t : y + t * h + c * h * t} `;

      str += `C 
        ${x + w * 0.5 - 2.0 * t * w + b * w * t - d * w * t}
        ${isTopOut ? y - 3.0 * t * h + c * h * t : y + 3.0 * t * h + c * h * t},
        
        ${x + w * 0.5 + 2.0 * t * w + b * w * t - d * w * t}
        ${isTopOut ? y - 3.0 * t * h + c * h * t : y + 3.0 * t * h + c * h * t},
        
        ${x + w * 0.5 + t * w + b * w * t}
        ${isTopOut ? y - t * h + c * h * t : y + t * h + c * h * t} `;

      str += `C 
        ${x + w * 0.5 + b * w * t + d * w * t}
        ${isTopOut ? y + t * h + c * h * t : y - t * h + c * h * t},
        
        ${x + w * 0.8}
        ${isTopOut ? y - e * h * t : y + e * h * t},
        
        ${x + w}
        ${y} `;
      next();
    }
  } else {
    str += `L ${x + w} ${y} `;
    next();
  }

// --- Правая грань ---
flip = false;
first();

if (curves & 2) {
  for (let i = 0; i < 1; i++) {
        str += `C 
          ${isRightOut ? x + w + a * w * t : x + w - a * w * t}
          ${y + h * 0.2},
          
          ${isRightOut ? x + w - t * w + b * w * t : x + w + t * w + b * w * t}
          ${y + h * 0.5 + c * h * t},
        
          ${isRightOut ? x + w + t * w + b * w * t : x + w - t * w + b * w * t}
          ${y + h * 0.5 - t * h + c * h * t} `;

        str += `C 
          ${isRightOut ? x + w + 3.0 * t * w + b * w * t : x + w - 3.0 * t * w + b * w * t}
          ${y + h * 0.5 - 2.0 * t * h + c * h * t},
          
          ${isRightOut ? x + w + 3.0 * t * w + b * w * t : x + w - 3.0 * t * w + b * w * t}
          ${y + h * 0.5 + 2.0 * t * h + c * h * t},
          
          ${isRightOut ? x + w + t * w + b * w * t : x + w - t * w + b * w * t}
          ${y + h * 0.5 + t * h + c * h * t} `;


        str += `C
          ${isRightOut ? x + w - t * w + b * w * t : x + w + t * w + b * w * t}
          ${y + h * 0.5 + c * h * t},
          
          ${isRightOut ? x + w + e * w * t : x + w - e * w * t}
          ${y + h * 0.8},
          
          ${x + w}
          ${y + h} `;

        // next();
  }
} else {
  str += `L ${x + w} ${y + h} `;
}
  // --- Нижняя грань ---
  flip = false;
  first();

  if (curves & 4) {
    for (let i = 0; i < 1; i++) {
      str += `C 
        ${x + w * 0.8}
        ${isBottomOut ? y + h + e * h * t : y + h - e * h * t},
        
        ${x + w * 0.5 + b * w * t + d * w * t}
        ${isBottomOut ? y + h - t * h + c * h * t : y + h + t * h + c * h * t},
        
        ${x + w * 0.5 + t * w + b * w * t}
        ${isBottomOut ? y + h + t * h + c * h * t : y + h - t * h + c * h * t} `;

      str += `C 
        ${x + w * 0.5 + 2.0 * t * w + b * w * t - d * w * t}
        ${isBottomOut ? y + h + 3.0 * t * h + c * h * t : y + h - 3.0 * t * h + c * h * t},
        
        ${x + w * 0.5 - 2.0 * t * w + b * w * t - d * w * t}
        ${isBottomOut ? y + h + 3.0 * t * h + c * h * t : y + h - 3.0 * t * h + c * h * t},
        
        ${x + w * 0.5 - t * w + b * w * t}
        ${isBottomOut ? y + h + t * h + c * h * t : y + h - t * h + c * h * t} `;

      str += `C 
        ${x + w * 0.5 - t * w + b * w * t}
        ${isBottomOut ? y + h - t * h + c * h * t : y + h + t * h + c * h * t},
        
        ${x + w * 0.2}
        ${isBottomOut ? y + h + a * h * t : y + h - a * h * t},
        
        ${x}
        ${y + h} `;
      next();
    }
  } else {
    str += `L ${x} ${y + h} `;
  }

  // --- Левая грань ---
  flip = true;
  first();

  if (curves & 8) {
    for (let i = 0; i < 1; i++) {

      str += `C
        ${isLeftOut ? x - a * w * t : x + a * w * t}
        ${y + h * 0.8},
        
        ${isLeftOut ? x + t * w - b * w * t : x - t * w - b * w * t} 
        ${y + h * 0.5 + c * h * t},
        
        ${isLeftOut ? x - t * w - b * w * t : x + t * w - b * w * t}
        ${y + h * 0.5 + t * h + c * h * t} `;


      str += `C 
        ${isLeftOut ? x - 3.0 * t * w - b * w * t : x + 3.0 * t * w - b * w * t}
        ${y + h * 0.5 + 2.0 * t * h + c * h * t},
        
        ${isLeftOut ? x - 3.0 * t * w - b * w * t : x + 3.0 * t * w - b * w * t} 
        ${y + h * 0.5 - 2.0 * t * h + c * h * t},
        
        ${isLeftOut ? x - t * w - b * w * t : x + t * w - b * w * t} 
        ${y + h * 0.5 - t * h + c * h * t} `;


      str += `C 
        ${isLeftOut ? x + t * w - b * w * t : x - t * w - b * w * t} 
        ${y + h * 0.5 + c * h * t},
        
        ${isLeftOut ? x - e * w * t : x + e * w * t} 
        ${y + h * 0.2},
        
        ${x} 
        ${y} `;

        next();
      }
    } else {
      str += `L ${x} ${y} `;
    }

  str += " Z";

  // Создаём новый path с уникальным ID
  const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
  path.setAttribute("id", newId);
  path.setAttribute("d", str);
  path.setAttribute("fill", "lightblue");
  path.setAttribute("stroke", "#000");
  path.setAttribute("stroke-width", "2");

  svg.appendChild(path);
}


  // --- Инициализация ---
  drawPiece(50, 50, true, true, false, true, 6);
  drawPiece(170, 50, true, true, true, false, 12);
  drawPiece(170, 170, false, true, false, false, 9);
  drawPiece(50, 170, true, true, false, true, 3);
  // drawPiece(120, 0);
</script>

</body>
</html>